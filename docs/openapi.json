{
  "openapi": "3.0.3",
  "info": {
    "title": "HZ Navigator API",
    "version": "1.0.0",
    "description": "# HZ Navigator API Documentation\n\nHZ Navigator is a comprehensive HUBZone certification management platform that helps businesses maintain compliance with SBA HUBZone program requirements.\n\n## Features\n\n- **Authentication**: JWT-based authentication with role-based access control\n- **Business Management**: Create and manage HUBZone certified businesses\n- **Compliance Monitoring**: Real-time compliance tracking and alerts\n- **Document Management**: Secure document upload and OCR processing\n- **Contract Tracking**: Agency contract management and goal tracking\n- **HUBZone Maps**: Geographic verification with vector tile support\n- **Analytics**: Comprehensive reporting and analytics dashboards\n\n## Authentication\n\nMost endpoints require authentication via JWT Bearer token:\n\n```\nAuthorization: Bearer <your-jwt-token>\n```\n\n## Rate Limiting\n\n- Authentication endpoints: 5 requests per minute\n- Password reset: 3 requests per hour\n- Standard API: 100 requests per minute\n- File uploads: 10 requests per minute\n- Admin endpoints: 30 requests per minute",
    "contact": {
      "name": "HZ Navigator Support",
      "email": "support@hz-navigator.gov",
      "url": "https://hz-navigator.gov/support"
    },
    "license": {
      "name": "Proprietary",
      "url": "https://hz-navigator.gov/terms"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Development server"
    },
    {
      "url": "https://api.hz-navigator.gov",
      "description": "Production server"
    },
    {
      "url": "https://api-staging.hz-navigator.gov",
      "description": "Staging server"
    }
  ],
  "tags": [
    { "name": "Authentication", "description": "User authentication and account management" },
    { "name": "Admin", "description": "Administrative operations (requires admin role)" },
    { "name": "Alerts", "description": "Compliance alerts and notifications" },
    { "name": "Analytics", "description": "Analytics and reporting" },
    { "name": "Agency", "description": "Agency contractor verification" },
    { "name": "Compliance", "description": "Business compliance monitoring" },
    { "name": "Contracts", "description": "Contract management and goal tracking" },
    { "name": "Documents", "description": "Document upload and management" },
    { "name": "Health", "description": "System health checks" },
    { "name": "HUBZones", "description": "HUBZone area lookup and verification" },
    { "name": "Map", "description": "Vector tiles and geographic data" },
    { "name": "Metrics", "description": "System metrics and monitoring (admin only)" },
    { "name": "OCR", "description": "Document OCR processing" }
  ],
  "paths": {
    "/api/auth/login": {
      "post": {
        "summary": "Authenticate user and obtain JWT token",
        "tags": ["Authentication"],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AuthResponse" }
              }
            }
          },
          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "429": { "$ref": "#/components/responses/RateLimitError" }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "summary": "Register a new user account",
        "tags": ["Authentication"],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/RegisterRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AuthResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/ValidationError" },
          "409": { "description": "Email already registered" }
        }
      }
    },
    "/api/auth/me": {
      "get": {
        "summary": "Get current user profile",
        "tags": ["Authentication"],
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": {
            "description": "User profile",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/UnauthorizedError" }
        }
      }
    },
    "/api/health": {
      "get": {
        "summary": "Check API health status",
        "tags": ["Health"],
        "security": [],
        "responses": {
          "200": {
            "description": "System is healthy",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HealthStatus" }
              }
            }
          },
          "503": { "description": "System is unhealthy" }
        }
      }
    },
    "/api/hubzones": {
      "get": {
        "summary": "List all HUBZone areas",
        "tags": ["HUBZones"],
        "security": [],
        "parameters": [
          { "$ref": "#/components/parameters/PageParam" },
          { "$ref": "#/components/parameters/LimitParam" },
          { "name": "search", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "List of HUBZone areas",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": { "type": "array", "items": { "$ref": "#/components/schemas/Hubzone" } },
                    "pagination": { "$ref": "#/components/schemas/Pagination" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/hubzones/check": {
      "post": {
        "summary": "Check if coordinates are in a HUBZone",
        "tags": ["HUBZones"],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["latitude", "longitude"],
                "properties": {
                  "latitude": { "type": "number", "minimum": -90, "maximum": 90 },
                  "longitude": { "type": "number", "minimum": -180, "maximum": 180 }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "HUBZone check result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HubzoneCheckResult" }
              }
            }
          }
        }
      }
    },
    "/api/v1/businesses/{businessId}/alerts": {
      "get": {
        "summary": "Get alerts for a business",
        "tags": ["Alerts"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "$ref": "#/components/parameters/BusinessIdParam" },
          { "$ref": "#/components/parameters/PageParam" },
          { "$ref": "#/components/parameters/LimitParam" }
        ],
        "responses": {
          "200": {
            "description": "List of alerts",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "type": "array", "items": { "$ref": "#/components/schemas/ComplianceAlert" } },
                    "pagination": { "$ref": "#/components/schemas/Pagination" }
                  }
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/UnauthorizedError" }
        }
      }
    },
    "/api/v1/alerts/dashboard": {
      "get": {
        "summary": "Get alerts dashboard summary",
        "tags": ["Alerts"],
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Dashboard summary",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "$ref": "#/components/schemas/AlertDashboardSummary" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/businesses/{businessId}/compliance/current": {
      "get": {
        "summary": "Get current compliance status",
        "tags": ["Compliance"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [{ "$ref": "#/components/parameters/BusinessIdParam" }],
        "responses": {
          "200": {
            "description": "Compliance status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "$ref": "#/components/schemas/ComplianceStatus" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/contracts": {
      "get": {
        "summary": "Get contracts with filters",
        "tags": ["Contracts"],
        "parameters": [
          { "$ref": "#/components/parameters/AgencyIdHeader" },
          { "$ref": "#/components/parameters/PageParam" },
          { "$ref": "#/components/parameters/LimitParam" },
          { "name": "fiscalYear", "in": "query", "schema": { "type": "integer" } },
          { "name": "isHubzoneContractor", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "List of contracts",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "type": "array", "items": { "$ref": "#/components/schemas/Contract" } },
                    "pagination": { "$ref": "#/components/schemas/Pagination" }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create a new contract",
        "tags": ["Contracts"],
        "parameters": [{ "$ref": "#/components/parameters/AgencyIdHeader" }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateContractRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Contract created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": { "$ref": "#/components/schemas/Contract" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/init-upload": {
      "post": {
        "summary": "Initialize document upload",
        "tags": ["Documents"],
        "security": [{ "BearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/InitUploadRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Upload initialized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/InitUploadResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/hubzone/update-map": {
      "post": {
        "summary": "Trigger HUBZone map update",
        "tags": ["Admin"],
        "security": [{ "BearerAuth": [] }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ManualTriggerRequest" }
            }
          }
        },
        "responses": {
          "202": { "description": "Job started" },
          "403": { "$ref": "#/components/responses/ForbiddenError" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "LoginRequest": {
        "type": "object",
        "required": ["email", "password"],
        "properties": {
          "email": { "type": "string", "format": "email", "example": "user@example.com" },
          "password": { "type": "string", "format": "password", "example": "SecureP@ss123" }
        }
      },
      "RegisterRequest": {
        "type": "object",
        "required": ["email", "password", "firstName", "lastName"],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string", "format": "password", "minLength": 8 },
          "firstName": { "type": "string", "maxLength": 100 },
          "lastName": { "type": "string", "maxLength": 100 }
        }
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "token": { "type": "string" },
              "user": { "$ref": "#/components/schemas/User" }
            }
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "email": { "type": "string", "format": "email" },
          "firstName": { "type": "string" },
          "lastName": { "type": "string" },
          "role": { "type": "string", "enum": ["user", "admin", "reviewer"] }
        }
      },
      "HealthStatus": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "enum": ["healthy", "unhealthy"] },
          "timestamp": { "type": "string", "format": "date-time" },
          "uptime": { "type": "number" },
          "services": {
            "type": "object",
            "properties": {
              "database": { "type": "string", "enum": ["connected", "disconnected"] }
            }
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": { "type": "integer" },
          "limit": { "type": "integer" },
          "total": { "type": "integer" },
          "totalPages": { "type": "integer" }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean", "example": false },
          "error": {
            "type": "object",
            "properties": {
              "message": { "type": "string" },
              "code": { "type": "string" }
            }
          }
        }
      },
      "Hubzone": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "geoid": { "type": "string" },
          "name": { "type": "string" },
          "zoneType": { "type": "string" },
          "status": { "type": "string", "enum": ["active", "expired", "pending", "redesignated"] },
          "state": { "type": "string" },
          "county": { "type": "string" }
        }
      },
      "HubzoneCheckResult": {
        "type": "object",
        "properties": {
          "isInHubzone": { "type": "boolean" },
          "hubzones": { "type": "array", "items": { "$ref": "#/components/schemas/Hubzone" } }
        }
      },
      "ComplianceAlert": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "businessId": { "type": "string", "format": "uuid" },
          "type": { "type": "string" },
          "severity": { "type": "string", "enum": ["low", "medium", "high", "critical"] },
          "status": { "type": "string", "enum": ["active", "acknowledged", "dismissed", "resolved"] },
          "title": { "type": "string" },
          "message": { "type": "string" },
          "actionRequired": { "type": "string" }
        }
      },
      "AlertDashboardSummary": {
        "type": "object",
        "properties": {
          "totalAlerts": { "type": "integer" },
          "byStatus": { "type": "object" },
          "bySeverity": { "type": "object" }
        }
      },
      "ComplianceStatus": {
        "type": "object",
        "properties": {
          "businessId": { "type": "string", "format": "uuid" },
          "overallStatus": { "type": "string", "enum": ["compliant", "at_risk", "non_compliant"] },
          "complianceScore": { "type": "integer", "minimum": 0, "maximum": 100 },
          "riskLevel": { "type": "string", "enum": ["low", "medium", "high", "critical"] }
        }
      },
      "Contract": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "contractNumber": { "type": "string" },
          "title": { "type": "string" },
          "contractorName": { "type": "string" },
          "contractorUei": { "type": "string" },
          "isHubzoneContractor": { "type": "boolean" },
          "awardDate": { "type": "string", "format": "date" },
          "awardValue": { "type": "number" },
          "status": { "type": "string" }
        }
      },
      "CreateContractRequest": {
        "type": "object",
        "required": ["contractNumber", "title", "contractorName", "contractorUei", "awardDate", "awardValue"],
        "properties": {
          "contractNumber": { "type": "string" },
          "title": { "type": "string" },
          "contractorName": { "type": "string" },
          "contractorUei": { "type": "string" },
          "isHubzoneContractor": { "type": "boolean" },
          "awardDate": { "type": "string", "format": "date" },
          "awardValue": { "type": "number" }
        }
      },
      "InitUploadRequest": {
        "type": "object",
        "required": ["originalFilename", "fileSize", "category"],
        "properties": {
          "originalFilename": { "type": "string" },
          "fileSize": { "type": "integer", "maximum": 10485760 },
          "category": { "type": "string", "enum": ["certification", "employee_verification", "ownership", "contract", "compliance_report", "miscellaneous"] }
        }
      },
      "InitUploadResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "documentId": { "type": "string", "format": "uuid" },
              "uploadUrl": { "type": "string", "format": "uri" },
              "expiresAt": { "type": "string", "format": "date-time" }
            }
          }
        }
      },
      "ManualTriggerRequest": {
        "type": "object",
        "properties": {
          "dry_run": { "type": "boolean", "default": false },
          "skip_notifications": { "type": "boolean", "default": false }
        }
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Authentication required",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "ForbiddenError": {
        "description": "Insufficient permissions",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "NotFoundError": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "ValidationError": {
        "description": "Validation error",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "RateLimitError": {
        "description": "Rate limit exceeded",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      }
    },
    "parameters": {
      "PageParam": {
        "name": "page",
        "in": "query",
        "schema": { "type": "integer", "minimum": 1, "default": 1 }
      },
      "LimitParam": {
        "name": "limit",
        "in": "query",
        "schema": { "type": "integer", "minimum": 1, "maximum": 100, "default": 20 }
      },
      "BusinessIdParam": {
        "name": "businessId",
        "in": "path",
        "required": true,
        "schema": { "type": "string", "format": "uuid" }
      },
      "AgencyIdHeader": {
        "name": "X-Agency-Id",
        "in": "header",
        "schema": { "type": "string" }
      }
    }
  },
  "security": [{ "BearerAuth": [] }]
}

